<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: content: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <script src="components/loader.js"></script>
    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="css/style.css">
    <script>
        window.onload = function(){
        var largura = 1000
        var altura = 600

        var quadro = document.getElementById('quadro')
        quadro.setAttribute("width", largura)
        quadro.setAttribute("height", altura)

         var ctx = quadro.getContext("2d")
         
         var desenhar = false
         quadro.onmousedown = function (evt){
             ctx.moveTo(evt.clientX,evt.clientY)
             desenhar=true
         }
         quadro.onmouseup=function(){
             desenhar=false
         }
         quadro.onmousemove=function(evt){
             if(desenhar)
             ctx.lineTo(evt.clientX,evt.clientY)
             ctx.stroke()
         }

        }
    function startup() {
  var quadro = document.getElementsByTagName("canvas")[0];
  quadro.addEventListener("touchstart", handleStart, false);
  quadro.addEventListener("touchleave", handleEnd, false);
   quadro.addEventListener("touchmove", handleMove, false);
  desenhar("initialized.");
}

var ongoingTouches = new Array;

function handleStart(evt) {
  evt.preventDefault();
  desenhar("touchstart.");
  var el = document.getElementsByTagName("canvas")[0];
  var ctx = el.getContext("2d");
  var touches = evt.changedTouches;

  for (var i=0; i < touches.length; i++) {
    log("touchstart:"+i+"...");
    ongoingTouches.push(copyTouch(touches[i]));
    var color = colorForTouch(touches[i]);
    ctx.beginPath();
    ctx.arc(touches[i].pageX, touches[i].pageY, 4, 0,2*Math.PI, false); 
    ctx.fill();
    desenhar("touchstart:"+i+".");
  }
}
function handleMove(evt) {
  evt.preventDefault();
  var  quadro = document.getElementsByTagName("canvas")[0];
  var ctx = el.getContext("2d");
  var touches = evt.changedTouches;

  for (var i=0; i < touches.length; i++) {
    var color = colorForTouch(touches[i]);
    var idx = ongoingTouchIndexById(touches[i].identifier);

    if(idx >= 0) {
      desenhar("continuing touch "+idx);
      ctx.beginPath();
      desenhar("ctx.moveTo("+ongoingTouches[idx].pageX+", "+ongoingTouches[idx].pageY+");");
      ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
      desenhar("ctx.lineTo("+touches[i].pageX+", "+touches[i].pageY+");");
      ctx.lineTo(touches[i].pageX, touches[i].pageY);
      ctx.lineWidth = 4;
      ctx.strokeStyle = color;
      ctx.stroke();

      ongoingTouches.splice(idx, 1, copyTouch(touches[i])); 
      log(".");
    } else {
      desenhar("can't figure out which touch to continue");
    }
  }
}

function ongoingTouchIndexById(idToFind) {
  for (var i=0; i < ongoingTouches.length; i++) {
    var id = ongoingTouches[i].identifier;

    if (id == idToFind) {
      return i;
    }
  }
  return -1;    
}
function desenhar(msg) {
  var p = document.getElementById('log');
  p.innerHTML = msg + "\n" + p.innerHTML;
}

    </script>
</head>
<body>
<canvas id="quadro" style="background:pink" width="1000px" height="600px'"></canvas>
<button onclick="startup()">Initialize</button>
<br>
<pre id="desenhar" style="border: 1px solid #ccc;"></pre>
</body>

</html>